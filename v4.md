# Cloudreve V4 API 文档

## 基本说明
1. 和 Cloudreve v3 不同的是，Cloudreve v4采用 JWT Bearer 鉴权。 在登录时，服务端会在客户端设置名为 `cloudreve-session` 的 cookie 。
因此，在调用 API 时，我们需要在每次请求中将该 cookie 中的 `access_token` 令牌发送给服务端。实现这一功能的方式有很多，在请求头添加
`Bearer ...` 即可，但在这里我们不展开讨论，因为这不是本项目的核心。
2. 除特殊说明外，本项目中所有API均应在调用时添加域名和路径前缀 `/api/v4` 。例如，我的网站地址为
https://pan.xiaoqiu.in/ ，文档中描述的接口地址为 /user/session ，那么在调用时，你应该将请求发送给
https://pan.xiaoqiu.in/api/v4/user/session 。
3. 本 API 文档基于 Cloudreve Pro V4-alpha9 编写，部分 API 可能在后续版本有所变动，请以后续版本为准。
4. 涉及到 Cloudreve 本身的授权 (如 VOL) 在本文档中不会被提及。

## 全局相关

### 获取站点元数据
- 方法: `GET`
- 路径: `/manifest.json`
- 响应示例: 
```json
{
    "background_color": "#ffffff",
    "display": "standalone",
    "icons": [
        {
            "sizes": "64x64 32x32 24x24 16x16",
            "src": "/statics/static/favicon.ico",
            "type": "image/x-icon"
        },
        {
            "sizes": "192x192",
            "src": "/statics/static/logo192.png",
            "type": "image/png"
        },
        {
            "sizes": "512x512",
            "src": "/statics/static/logo512.png",
            "type": "image/png"
        }
    ],
    "name": "Cloudreve",
    "short_name": "Cloudreve",
    "start_url": ".",
    "theme_color": "#000000"
}
```

### Ping 站点
- 方法: `GET`
- 路径: `/api/v4/site/ping`
- 响应示例:
```json
{
    "code":0,
    "data":"4.0.0",
    "msg":""
}
```

### 获得普通验证码图片
- 方法: `GET`
- 路径: `/api/v4/site/captcha`
- 响应示例: 
```json
{
    "code":0,
    "data":{
        "image":"data:image/png;base64, ... ",
        "ticket":"FGxe7kyEV4r10MDdZhMB"
        },
    "msg":""
}
```

### 获取站点配置
- 方法: `GET`
- 路径: `/api/v4/site/config/:section`
- 参数: 
    - `section`: 传入任意值均可，否则 Return 404
- 响应示例:
```json
{
    "code":0,
    "data":{
        "instance_id":"{请求ID}",
        "title":"Cloudreve",
        "themes":"{json}",
        "default_theme":"#1976d2",
        "site_notice":"",
        "user":{
            "id":"3ktq",
            "nickname":"",
            "created_at":"0001-01-01T00:00:00Z",
            "anonymous":true,
            "group":{
                "id":"dqcz",
                "name":"Anonymous",
                "permission":"gg=="
                }
            },
        "logo":"/statics/static/logo.svg",
        "logo_light":"/statics/static/logo_light.svg",
        "shop_nav_enabled":true,
        "captcha_ReCaptchaKey":"defaultKey",
        "captcha_type":"turnstile",
        "turnstile_site_id":"{key}"
        },
    "msg":""
}
```

## 鉴权路由

### 登录准备
- 方法: `GET`
- 路径: `/api/v4/session/prepare`
- 参数: 
    - `email`: 待登录用户的邮箱
- 响应示例:
```json
// 成功示例
{
    "code":0,
    "data":{
        "webauthn_enabled":true,
        "sso_enabled":false,
        "password_enabled":true,
        "qq_enabled":false
        },
    "msg":""
}

// 失败示例 邮箱不能为空
{
    "code":40001,
    "msg":"Email cannot be empty"
}
```

### 获得令牌
- 方法: `POST`
- 路径: `/api/v4/session/token`
- 请求参数:
    - `email`: 用户邮箱
    - `password`: 密码
- 响应示例:
```json
{
    "code":0,
    "data":{
        "user":{
            "id":"0721",
            "email":"admin@yuxiaoqiu.cn",
            "nickname":"admin",
            "status":"active",
            "created_at":"2025-03-23T17:05:43.7517532+08:00",
            "group":{
                "id":"LyTN",
                "name":"Admin",
                "permission":"/X8B",
                "direct_link_batch_size":1000
                },
            "language":"zh-CN"
            },
        "token":{
            "access_token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwic3ViIjoibllUNiIsImV4cCI6MTc0MzA3MjkxMCwibmJmIjoxNzQzMDY5MzEwfQ.QYSBOtDSnQzHIuSKT9fwMhc7p5cMZLIaQQjHthn4ePU",
            "refresh_token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoicmVmcmVzaCIsInN1YiI6Im5ZVDYiLCJleHAiOjE3NDQyNzg5MTAsIm5iZiI6MTc0MzA2OTMxMCwic3RhdGVfaGFzaCI6IlMrTDBQZGdiUzgrR003R1Y3RTMvbjRhSHdnMFNMQ1hlZk53cjJmdWViME09In0.q4qxofCDfp23kOPSyER_euOU-Y_3DAxvZ3v53OlMJOw",
            "access_expires":"2025-03-27T18:55:10.041224+08:00",
            "refresh_expires":"2025-04-10T17:55:10.041224+08:00"
            }
        },
    "msg":""
}
```

- 方法: `POST`   /api/v4/session/token/2fa --> github.com/cloudreve/Cloudreve/v4/routers/controllers.UserIssueToken (11 handlers)
- 方法: `POST`   /api/v4/session/token/refresh --> github.com/cloudreve/Cloudreve/v4/routers/controllers.UserRefreshToken (10 handlers)
- 方法: `PUT`    /api/v4/session/openid    --> github.com/cloudreve/Cloudreve/v4/routers/controllers.UserOpenIDPrepare (11 handlers)
- 方法: `POST`   /api/v4/session/openid    --> github.com/cloudreve/Cloudreve/v4/routers/controllers.UserIssueToken (12 handlers)
- 方法: `DELETE` /api/v4/session/openid/:open_id --> github.com/cloudreve/Cloudreve/v4/routers/controllers.UserUnlinkOpenID (12 handlers)
- 方法: `PUT`    /api/v4/session/authn     --> github.com/cloudreve/Cloudreve/v4/routers/controllers.StartLoginAuthn (10 handlers)

### 用户登录
- 方法: `POST`
- 路径: `/api/v4/session/authn`
- 请求参数:
    - `email`: 用户邮箱
    - `password`: 密码
- 响应示例:
```json
{
    "code":0,
    "data":{
        "user":{
            "id":"0721",
            "email":"admin@yuxiaoqiu.cn",
            "nickname":"admin",
            "status":"active",
            "created_at":"2025-03-23T17:05:43.7517532+08:00",
            "group":{
                "id":"LyTN",
                "name":"Admin",
                "permission":"/X8B",
                "direct_link_batch_size":1000
                },
            "language":"zh-CN"
            },
        "token":{
            "access_token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwic3ViIjoibllUNiIsImV4cCI6MTc0MzA3MjkxMCwibmJmIjoxNzQzMDY5MzEwfQ.QYSBOtDSnQzHIuSKT9fwMhc7p5cMZLIaQQjHthn4ePU",
            "refresh_token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoicmVmcmVzaCIsInN1YiI6Im5ZVDYiLCJleHAiOjE3NDQyNzg5MTAsIm5iZiI6MTc0MzA2OTMxMCwic3RhdGVfaGFzaCI6IlMrTDBQZGdiUzgrR003R1Y3RTMvbjRhSHdnMFNMQ1hlZk53cjJmdWViME09In0.q4qxofCDfp23kOPSyER_euOU-Y_3DAxvZ3v53OlMJOw",
            "access_expires":"2025-03-27T18:55:10.041224+08:00",
            "refresh_expires":"2025-04-10T17:55:10.041224+08:00"
            }
        },
    "msg":""
}
```

## 用户路由

### 用户注册
- 方法: `POST`
- 路径: `/api/v4/user`

- 方法: `PATCH`  /api/v4/user/reset/:id    --> github.com/cloudreve/Cloudreve/v4/routers/controllers.UserReset (11 handlers)

### 发送密码重置邮件
- 方法: `POST`
- 路由: `/api/v4/user/reset`


- 方法: `GET`    /api/v4/user/activate/:id --> github.com/cloudreve/Cloudreve/v4/routers/controllers.UserActivate (12 handlers)

### 获取用户头像
- 方法: `GET`
- 路径: `/api/v4/user/avatar/:id`
- 参数: `id`: 用户公共ID
- 响应示例: `image`

### 获取用户信息
- 方法: `GET`
- 路径: `/api/v4/user/info/:id`
- 参数: `id`: 用户公共ID
- 响应示例:
```json
{
    "code": 0,
    "data": {
        "id": "0721",
        "nickname": "于小丘",
        "avatar": "file",
        "created_at": "2025-03-23T11:30:49.481874608+08:00",
        "group": {
            "id": "2333",
            "name": "管理员"
        }
    },
    "msg": ""
}
```

- 方法: `GET`    /api/v4/user/shares/:id   --> github.com/cloudreve/Cloudreve/v4/routers/controllers.ListPublicShare (11 handlers)
- 方法: `GET`    /api/v4/user/session/copy/:id --> github.com/cloudreve/Cloudreve/v4/routers/controllers.UserPerformCopySession (11 handlers)

### 获取个人信息
- 方法: `GET`
- 路径: `/api/v4/user/me`
- 响应示例:
```json
{
    "code":0,
    "data":{
        "id":"nYT6",
        "email":"admin@yuxiaoqiu.cn",
        "nickname":"admin",
        "status":"active",
        "created_at":"2025-03-23T17:05:43.7517532+08:00",
        "group":{
            "id":"LyTN",
            "name":"Admin",
            "permission":"/X8B",
            "direct_link_batch_size":1000
            },
        "language":"zh-CN"
        },
    "msg":""
}
```

### 获取容量
- 方法: `GET`
- 路径: `/api/v4/user/capacity`
- 响应示例:
```json
{
    "code":0,
    "data":{
        "total":1099511627776,
        "used":0,
        "storage_pack_total":0
        },
    "msg":""
}
```

### 搜索？
- 方法: `GET`
- 路径: `/api/v4/user/search`
- 参数: `keywords`: 查询内容
- 响应示例:
```json
{
    "code":0,
    "data":[],
    "msg":""
}
```

### 退出登录
- 方法: `DELETE`
- 路径: `/api/v4/user/session`
- 响应示例:
```json
// 待测试
```

### authn 通行密钥相关 暂时无能力测试

#### 开始添加通行密钥
- 方法: `PUT`    /api/v4/user/authn        --> github.com/cloudreve/Cloudreve/v4/routers/controllers.StartRegAuthn (11 handlers)
#### 停止添加通行密钥
- 方法: `POST`   /api/v4/user/authn        --> github.com/cloudreve/Cloudreve/v4/routers/controllers.FinishRegAuthn (12 handlers)
#### 删除通行密钥
- 方法: `DELETE` /api/v4/user/authn        --> github.com/cloudreve/Cloudreve/v4/routers/controllers.UserDeletePasskey (12 handlers)

### 获取用户可用的存储策略
- 方法: `GET`
- 路径: `/api/v4/user/setting/policies`
- 响应示例:
```json
{
    "code":0,
    "data":[
            {
            "id":"kxTm",
            "name":"Default storage policy",
            "type":"local",
            "max_size":0
            }
        ],
    "msg":""
}
```

### 获取用户可用的离线下载节点
- 方法: `GET`
- 路径: `/api/v4/user/setting/nodes`
- 响应示例:
```json
{
    "code":0,
    "data":[
            {
            "id":"Y6TY",
            "name":"Master",
            "type":"master",
            "capabilities":"Hg=="
            }
        ],
    "msg":""
}
```

### 获取用户设置
- 方法: `GET`
- 路径: `/api/v4/user/setting`
- 响应示例: 
```json
{
    "code":0,
    "data":{
        "version_retention_enabled":true,
        "version_retention_max":10,
        "passwordless":false,
        "two_fa_enabled":false,
        "login_activity":[
            {
                "created_at":"2025-03-27T17:55:10.0080236+08:00",
                "ip":"127.0.0.1",
                "browser":"Python Requests",
                "device":"Other",
                "os":"Other",
                "login_with":"",
                "open_id_provider":0,
                "success":true,
                "webdav":false
            },
            {
                "created_at":"2025-03-23T17:05:46.469563+08:00",
                "ip":"127.0.0.1",
                "browser":"Edge",
                "device":"Other",
                "os":"Windows",
                "login_with":"",
                "open_id_provider":0,
                "success":true,
                "webdav":false
            }
            ],
        "credit":0
    },
    "msg":""
}
```

### 更新用户头像
- 方法: `PUT`
- 路径: `/api/v4/user/setting/avatar`
- 响应示例:
```json
// 待补充
```

### 更新用户设置
- 方法: `PATCH`
- 路径: `/api/v4/user/setting`
- 响应示例:

### 获取两步验证密钥
- 方法: `GET`
- 路径: `/api/v4/user/setting/2fa`
- 响应示例:
```json
{
    "code":0,
    "data":"Q3AFVGTHPSZYIWBMPM7UAC7IW4TESHLN",
    "msg":""
}
```

### 获取积分变动明细
- 方法: `GET`
- 路径: `/api/v4/user/creditChanges`
- 参数: 
    - `page_size`: 分页大小
    - `page`: 页码
- 响应示例:
```json
{
    "code":0,
    "data":{
        "pagination":{
            "page":0,
            "page_size":10,
            "is_cursor":true
            },
        "changes":[]
        },
    "msg":""
}
```

## 获取用户支付记录？
- 方法: `GET`
- 路径: `/api/v4/user/payments`
- 参数: 
    - `page_size`: 分页大小
    - `page`: 页码
- 响应示例:
```json
{
    "code":0,
    "data":{
        "pagination":{
            "page":0,
            "page_size":10,
            "is_cursor":true
            },
        "payments":[]
        },
    "msg":""
}
```

## 从机路由

###
- 方法: `POST`   /api/v4/slave/upload/:sessionId --> github.com/cloudreve/Cloudreve/v4/routers/controllers.SlaveUpload (11 handlers)
- 方法: `PUT`    /api/v4/slave/upload      --> github.com/cloudreve/Cloudreve/v4/routers/controllers.Slave`GET`UploadSession (11 handlers)
- 方法: `DELETE` /api/v4/slave/upload/:sessionId --> github.com/cloudreve/Cloudreve/v4/routers/controllers.SlaveDeleteUploadSession (11 handlers)
- 方法: `GET`    /api/v4/slave/file/content/:nodeId/:src/:speed/:name --> github.com/cloudreve/Cloudreve/v4/routers/controllers.SlaveServeEntity (12 handlers)
- 方法: `HEAD`   /api/v4/slave/file/content/:nodeId/:src/:speed/:name --> github.com/cloudreve/Cloudreve/v4/routers/controllers.SlaveServeEntity (11 handlers)
- 方法: `GET`    /api/v4/slave/file/meta/:src/:ext --> github.com/cloudreve/Cloudreve/v4/routers/controllers.SlaveMeta (11 handlers)
- 方法: `GET`    /api/v4/slave/file/thumb/:src/:ext --> github.com/cloudreve/Cloudreve/v4/routers/controllers.SlaveThumb (11 handlers)
- 方法: `DELETE` /api/v4/slave/file        --> github.com/cloudreve/Cloudreve/v4/routers/controllers.SlaveDelete (11 handlers)
- 方法: `GET`    /api/v4/slave/credential/:id --> github.com/cloudreve/Cloudreve/v4/routers/controllers.Slave`GET`Credential (11 handlers)
- 方法: `PUT`    /api/v4/slave/statelessUpload/prepare --> github.com/cloudreve/Cloudreve/v4/routers/controllers.StatelessPrepareUpload (12 handlers)
- 方法: `POST`   /api/v4/slave/statelessUpload/complete --> github.com/cloudreve/Cloudreve/v4/routers/controllers.StatelessCompleteUpload (12 handlers)
- 方法: `POST`   /api/v4/slave/statelessUpload/failed --> github.com/cloudreve/Cloudreve/v4/routers/controllers.StatelessOnUploadFailed (12 handlers)
- 方法: `POST`   /api/v4/slave/statelessUpload/create --> github.com/cloudreve/Cloudreve/v4/routers/controllers.StatelessCreateFile (12 handlers)

## 回调路由

###
- 方法: `POST`   /api/v4/callback/alipay/:tradeNo --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AlipayCallback (11 handlers)
- 方法: `POST`   /api/v4/callback/wechat/:tradeNo --> github.com/cloudreve/Cloudreve/v4/routers/controllers.WechatCallback (11 handlers)
- 方法: `GET`    /api/v4/callback/stripe   --> github.com/cloudreve/Cloudreve/v4/routers/controllers.StripeCallback (10 handlers)
- 方法: `POST`   /api/v4/callback/stripe   --> github.com/cloudreve/Cloudreve/v4/routers/controllers.StripeCallback (10 handlers)
- 方法: `PUT`    /api/v4/callback/stripe   --> github.com/cloudreve/Cloudreve/v4/routers/controllers.StripeCallback (10 handlers)
- 方法: `PATCH`  /api/v4/callback/stripe   --> github.com/cloudreve/Cloudreve/v4/routers/controllers.StripeCallback (10 handlers)
- 方法: `HEAD`   /api/v4/callback/stripe   --> github.com/cloudreve/Cloudreve/v4/routers/controllers.StripeCallback (10 handlers)
- 方法: `OPTIONS` /api/v4/callback/stripe   --> github.com/cloudreve/Cloudreve/v4/routers/controllers.StripeCallback (10 handlers)
- 方法: `DELETE` /api/v4/callback/stripe   --> github.com/cloudreve/Cloudreve/v4/routers/controllers.StripeCallback (10 handlers)
- 方法: `CONNECT` /api/v4/callback/stripe   --> github.com/cloudreve/Cloudreve/v4/routers/controllers.StripeCallback (10 handlers)
- 方法: `TRACE`  /api/v4/callback/stripe   --> github.com/cloudreve/Cloudreve/v4/routers/controllers.StripeCallback (10 handlers)
- 方法: `GET`    /api/v4/callback/custom/:tradeNo --> github.com/cloudreve/Cloudreve/v4/routers/controllers.CustomCallback (11 handlers)
- 方法: `POST`   /api/v4/callback/remote/:sessionID/:key --> github.com/cloudreve/Cloudreve/v4/routers.initMasterRouter.ProcessCallback.func64 (12 handlers)
- 方法: `POST`   /api/v4/callback/oss/:sessionID/:key --> github.com/cloudreve/Cloudreve/v4/routers.initMasterRouter.ProcessCallback.func67 (13 handlers)
- 方法: `POST`   /api/v4/callback/upyun/:sessionID/:key --> github.com/cloudreve/Cloudreve/v4/routers.initMasterRouter.ProcessCallback.func69 (12 handlers)
- 方法: `POST`   /api/v4/callback/onedrive/:sessionID/:key --> github.com/cloudreve/Cloudreve/v4/routers.initMasterRouter.ProcessCallback.func71 (11 handlers)
- 方法: `GET`    /api/v4/callback/googledrive/auth --> github.com/cloudreve/Cloudreve/v4/routers/controllers.GoogleDriveOAuth (10 handlers)
- 方法: `GET`    /api/v4/callback/cos/:sessionID/:key --> github.com/cloudreve/Cloudreve/v4/routers.initMasterRouter.ProcessCallback.func73 (11 handlers)
- 方法: `GET`    /api/v4/callback/s3/:sessionID/:key --> github.com/cloudreve/Cloudreve/v4/routers.initMasterRouter.ProcessCallback.func75 (11 handlers)
- 方法: `POST`   /api/v4/callback/obs/:sessionID/:key --> github.com/cloudreve/Cloudreve/v4/routers.initMasterRouter.ProcessCallback.func77 (11 handlers)
- 方法: `POST`   /api/v4/callback/qiniu/:sessionID/:key --> github.com/cloudreve/Cloudreve/v4/routers.initMasterRouter.ProcessCallback.func79 (12 handlers)

## 文件路由

### 获得文件目录
- 方法: `GET`
- 路径: `/api/v4/file`
- 参数:
    - `path`: 文件路径，必须以 `cloudreve://` 开头
    - `page_size`: 分页大小
    - `page`: 页码
- 返回示例:
```json
{
    "code":0,
    "data":{
        "files":[],
        "parent":{
            "type":1,
            "id":"2ATR",
            "name":"",
            "permission":null,
            "created_at":"2025-03-23T17:05:46.7121552+08:00",
            "updated_at":"2025-03-23T17:05:46.7121552+08:00",
            "size":0,
            "metadata":null,
            "path":"cloudreve://my/",
            "capability":"39/9",
            "owned":true,
            "primary_entity":"LWCY"
            },
        "pagination":{
            "page":0,
            "page_size":10,
            "is_cursor":true
            },
        "props":{
            "capability":"39/9",
            "max_page_size":2000,
            "order_by_options":[
                "name","size",
                "updated_at",
                "created_at"
                ],
            "order_direction_options":[
                "asc",
                "desc"
                ]
            },
        "context_hint":"632f5431-8f2c-4112-bffb-66fb158c5178",
        "mixed_type":false,
        "storage_policy":{
            "id":"kxTm",
            "name":"Default storage policy",
            "type":"local",
            "max_size":0
            }
        },
    "msg":""
}
```

- 方法: `GET`    /api/v4/file/activities   --> github.com/cloudreve/Cloudreve/v4/routers/controllers.ListFileActivities (11 handlers)
- 方法: `PATCH`  /api/v4/file/policy       --> github.com/cloudreve/Cloudreve/v4/routers/controllers.Mount (12 handlers)

### 创建文件(夹)
- 方法: `POST`
- 路径: `/api/v4/file/create`
- 参数:
    - `uri`: 文件(夹)完整路径，如 `cloudreve://my/README.md`
    - `type`: 文件(夹)类型，如 `file`、`folder`
- 响应示例:
```json
// 文件
{
    "code":0,
    "data":{
        "type":0,
        "id":"k3uP",
        "name":"1234.txt",
        "permission":null,
        "created_at":"2025-03-27T19:09:32.1169196+08:00",
        "updated_at":"2025-03-27T19:09:32.1169196+08:00",
        "size":0,
        "metadata":null,
        "path":"cloudreve://my/1234.txt",
        "capability":"39/9",
        "owned":true,
        "primary_entity":"LWCY"
        },
    "msg":""
}

// 文件夹
{
    "code": 0,
    "data": {
        "type": 1,
        "id": "x9F1",
        "name": "新建文件夹",
        "permission": null,
        "created_at": "2025-03-27T19:22:53.2929764+08:00",
        "updated_at": "2025-03-27T19:22:53.2929764+08:00",
        "size": 0,
        "metadata": null,
        "path": "cloudreve://my/新建文件夹",
        "capability": "39/9",
        "owned": true,
        "primary_entity": "LWCY"
    },
    "msg": ""
}
```

### 重命名文件(夹)
- 方法: `POST`
- 路径: `/api/v4/file/rename`
- 参数:
    - `uri`: 文件(夹)完整路径，如 `cloudreve://my/README.md`
    - `new_name`: 新文件(夹)名
- 返回示例:
```json
{
    "code": 0,
    "data": {
        "type": 0,
        "id": "Mwfa",
        "name": "123.md",
        "permission": null,
        "created_at": "2025-03-27T19:04:35.9581581+08:00",
        "updated_at": "2025-03-27T19:17:18.5811722+08:00",
        "size": 0,
        "metadata": null,
        "path": "cloudreve://my/123.md",
        "capability": "39/9",
        "owned": true,
        "primary_entity": "LWCY"
    },
    "msg": ""
}
```

### 移动/复制文件(夹)
- 方法: `POST`
- 路径: `/api/v4/file/move`
- 参数:
    - `copy`: 是否为复制。如果移动文件(夹)，传入false，否则传入true
    - `dst`: 目标完整路径
    - `uris`: 文件列表，如 `["cloudreve://my/12.txt"]`


### 文件权限设置
- 方法: `POST`
- 路径: `/api/v4/file/permission`
- 参数:
    - `uris`: 文件列表，如 `["cloudreve://my/12.txt"]`
    - `settings`: 权限设置 `{anonymous: "Aw==", everyone: "AQ=="}`
- 响应示例:
```json
{
    "code":0,
    "msg":""
}
```

### 清除权限设置
- 方法: `DELETE`
- 路径: `/api/v4/file/permission`
- 参数:
    - `uris`: 文件列表，如 `["cloudreve://my/12.txt"]`
- 响应示例:
```json
{
    "code":0,
    "msg":""
}
```

- 方法: `POST`   /api/v4/file/url          --> github.com/cloudreve/Cloudreve/v4/routers/controllers.FileURL (13 handlers)
- 方法: `PUT`    /api/v4/file/content      --> github.com/cloudreve/Cloudreve/v4/routers/controllers.PutContent (12 handlers)
- 方法: `OPTIONS` /api/v4/file/content/*option --> github.com/gin-contrib/cors.New.func1 (11 handlers)
- 方法: `GET`    /api/v4/file/content/:id/:speed/:name --> github.com/cloudreve/Cloudreve/v4/routers/controllers.ServeEntity (15 handlers)
- 方法: `HEAD`   /api/v4/file/content/:id/:speed/:name --> github.com/cloudreve/Cloudreve/v4/routers/controllers.ServeEntity (14 handlers)
- 方法: `GET`    /api/v4/file/thumb        --> github.com/cloudreve/Cloudreve/v4/routers/controllers.Thumb (12 handlers)
- 方法: `DELETE` /api/v4/file              --> github.com/cloudreve/Cloudreve/v4/routers/controllers.Delete (13 handlers)
- 方法: `DELETE` /api/v4/file/lock         --> github.com/cloudreve/Cloudreve/v4/routers/controllers.Unlock (12 handlers)
- 方法: `POST`   /api/v4/file/restore      --> github.com/cloudreve/Cloudreve/v4/routers/controllers.Restore (13 handlers)
- 方法: `PATCH`  /api/v4/file/metadata     --> github.com/cloudreve/Cloudreve/v4/routers/controllers.PatchMetadata (13 handlers)
- 方法: `PUT`    /api/v4/file/upload       --> github.com/cloudreve/Cloudreve/v4/routers/controllers.CreateUploadSession (12 handlers)
- 方法: `POST`   /api/v4/file/upload/:sessionId/:index --> github.com/cloudreve/Cloudreve/v4/routers/controllers.FileUpload (12 handlers)
- 方法: `DELETE` /api/v4/file/upload       --> github.com/cloudreve/Cloudreve/v4/routers/controllers.DeleteUploadSession (12 handlers)
- 方法: `PUT`    /api/v4/file/pin          --> github.com/cloudreve/Cloudreve/v4/routers/controllers.Pin (12 handlers)
- 方法: `DELETE` /api/v4/file/pin          --> github.com/cloudreve/Cloudreve/v4/routers/controllers.Unpin (12 handlers)

### 获取文件信息
- 方法: `GET`
- 路径: `/api/v4/file/info`
- 参数:
    - `uri`: 文件(夹)完整路径，如 `cloudreve://my/README.md`
- 响应示例:
```json
{
    "code": 0,
    "data": {
        "type": 0,
        "id": "k3uP",
        "name": "1234.txt",
        "permission": null,
        "created_at": "2025-03-27T19:09:32.1169196+08:00",
        "updated_at": "2025-03-27T19:09:32.1169196+08:00",
        "size": 0,
        "metadata": {},
        "path": "cloudreve://my/1234.txt",
        "capability": "39/9",
        "owned": true,
        "primary_entity": "LWCY",
        "extended_info": {
            "storage_policy": {
                "id": "kxTm",
                "name": "Default storage policy",
                "type": "local",
                "max_size": 0
            },
            "storage_policy_inherited": false,
            "storage_used": 0
        }
    },
    "msg": ""
}
```

- 方法: `POST`   /api/v4/file/version/current --> github.com/cloudreve/Cloudreve/v4/routers/controllers.SetCurrentVersion (12 handlers)
- 方法: `DELETE` /api/v4/file/version      --> github.com/cloudreve/Cloudreve/v4/routers/controllers.DeleteVersion (12 handlers)
- 方法: `PUT`    /api/v4/file/viewerSession --> github.com/cloudreve/Cloudreve/v4/routers/controllers.CreateViewerSession (12 handlers)
- 方法: `PUT`    /api/v4/file/source       --> github.com/cloudreve/Cloudreve/v4/routers/controllers.`GET`Source (13 handlers)

### 下载已压缩完成的压缩包
- 方法: `GET`
- 路径: `/api/v4/file/archive/:sessionID/archive.zip`


## 管理员路由

###
- 方法: `GET`    /api/v4/admin/summary     --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminSummary (12 handlers)
- 方法: `POST`   /api/v4/admin/license/refreshAuto --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminRefreshLicenseAuto (11 handlers)
- 方法: `POST`   /api/v4/admin/license/refreshManual --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminRefreshLicenseManual (12 handlers)
- 方法: `POST`   /api/v4/admin/settings    --> github.com/cloudreve/Cloudreve/v4/routers/controllers.Admin`GET`Settings (12 handlers)
- 方法: `PATCH`  /api/v4/admin/settings    --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminSetSettings (12 handlers)
- 方法: `POST`   /api/v4/admin/group       --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminListGroups (12 handlers)
- 方法: `GET`    /api/v4/admin/group/:id   --> github.com/cloudreve/Cloudreve/v4/routers/controllers.Admin`GET`Group (12 handlers)
- 方法: `PUT`    /api/v4/admin/group       --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminCreateGroup (12 handlers)
- 方法: `PUT`    /api/v4/admin/group/:id   --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminUpdateGroup (12 handlers)
- 方法: `DELETE` /api/v4/admin/group/:id   --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminDeleteGroup (12 handlers)
- 方法: `GET`    /api/v4/admin/tool/wopi   --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminFetchWopi (12 handlers)
- 方法: `POST`   /api/v4/admin/tool/thumbExecutable --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminTestThumbGenerator (12 handlers)
- 方法: `POST`   /api/v4/admin/tool/mail   --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminSendTestMail (12 handlers)
- 方法: `DELETE` /api/v4/admin/tool/entityUrlCache --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminClearEntityUrlCache (11 handlers)
- 方法: `POST`   /api/v4/admin/giftCodes   --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminListRedeems (12 handlers)
- 方法: `PUT`    /api/v4/admin/giftCodes   --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminGenerateRedeems (12 handlers)
- 方法: `DELETE` /api/v4/admin/giftCodes/:id --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminDeleteRedeem (12 handlers)
- 方法: `GET`    /api/v4/admin/queue/metrics --> github.com/cloudreve/Cloudreve/v4/routers/controllers.Admin`GET`QueueMetrics (11 handlers)
- 方法: `POST`   /api/v4/admin/queue       --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminListTasks (12 handlers)
- 方法: `GET`    /api/v4/admin/queue/:id   --> github.com/cloudreve/Cloudreve/v4/routers/controllers.Admin`GET`Task (12 handlers)
- 方法: `POST`   /api/v4/admin/queue/batch/delete --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminBatchDeleteTask (12 handlers)
- 方法: `POST`   /api/v4/admin/policy      --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminListPolicies (12 handlers)
- 方法: `GET`    /api/v4/admin/policy/:id  --> github.com/cloudreve/Cloudreve/v4/routers/controllers.Admin`GET`Policy (12 handlers)
- 方法: `PUT`    /api/v4/admin/policy      --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminCreatePolicy (12 handlers)
- 方法: `PUT`    /api/v4/admin/policy/:id  --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminUpdatePolicy (12 handlers)
- 方法: `POST`   /api/v4/admin/policy/cors --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminCreateStoragePolicyCors (12 handlers)
- 方法: `POST`   /api/v4/admin/policy/oauth/signin --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminOdOAuthURL (12 handlers)
- 方法: `GET`    /api/v4/admin/policy/oauth/redirect --> github.com/cloudreve/Cloudreve/v4/routers/controllers.Admin`GET`PolicyOAuthCallbackURL (11 handlers)
- 方法: `GET`    /api/v4/admin/policy/oauth/status/:id --> github.com/cloudreve/Cloudreve/v4/routers/controllers.Admin`GET`PolicyOAuthStatus (12 handlers)
- 方法: `POST`   /api/v4/admin/policy/oauth/callback --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminFinishOauthCallback (12 handlers)
- 方法: `GET`    /api/v4/admin/policy/oauth/root/:id --> github.com/cloudreve/Cloudreve/v4/routers/controllers.Admin`GET`SharePointDriverRoot (12 handlers)
- 方法: `DELETE` /api/v4/admin/policy/:id  --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminDeletePolicy (12 handlers)
- 方法: `POST`   /api/v4/admin/node        --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminListNodes (12 handlers)
- 方法: `GET`    /api/v4/admin/node/:id    --> github.com/cloudreve/Cloudreve/v4/routers/controllers.Admin`GET`Node (12 handlers)
- 方法: `POST`   /api/v4/admin/node/test   --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminTestSlave (12 handlers)
- 方法: `POST`   /api/v4/admin/node/test/downloader --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminTestDownloader (12 handlers)
- 方法: `PUT`    /api/v4/admin/node        --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminCreateNode (12 handlers)
- 方法: `PUT`    /api/v4/admin/node/:id    --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminUpdateNode (12 handlers)
- 方法: `DELETE` /api/v4/admin/node/:id    --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminDeleteNode (12 handlers)
- 方法: `POST`   /api/v4/admin/user        --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminListUsers (12 handlers)
- 方法: `GET`    /api/v4/admin/user/:id    --> github.com/cloudreve/Cloudreve/v4/routers/controllers.Admin`GET`User (12 handlers)
- 方法: `PUT`    /api/v4/admin/user/:id    --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminUpdateUser (12 handlers)
- 方法: `PUT`    /api/v4/admin/user        --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminCreateUser (12 handlers)
- 方法: `POST`   /api/v4/admin/user/batch/delete --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminDeleteUser (12 handlers)
- 方法: `POST`   /api/v4/admin/file        --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminListFiles (12 handlers)
- 方法: `GET`    /api/v4/admin/file/:id    --> github.com/cloudreve/Cloudreve/v4/routers/controllers.Admin`GET`File (12 handlers)
- 方法: `PUT`    /api/v4/admin/file/:id    --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminUpdateFile (12 handlers)
- 方法: `GET`    /api/v4/admin/file/url/:id --> github.com/cloudreve/Cloudreve/v4/routers/controllers.Admin`GET`FileUrl (12 handlers)
- 方法: `POST`   /api/v4/admin/file/batch/delete --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminBatchDeleteFile (12 handlers)
- 方法: `POST`   /api/v4/admin/entity      --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminListEntities (12 handlers)
- 方法: `GET`    /api/v4/admin/entity/:id  --> github.com/cloudreve/Cloudreve/v4/routers/controllers.Admin`GET`Entity (12 handlers)
- 方法: `POST`   /api/v4/admin/entity/batch/delete --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminBatchDeleteEntity (12 handlers)
- 方法: `GET`    /api/v4/admin/entity/url/:id --> github.com/cloudreve/Cloudreve/v4/routers/controllers.Admin`GET`EntityUrl (12 handlers)
- 方法: `POST`   /api/v4/admin/event       --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminListAuditLogs (12 handlers)
- 方法: `GET`    /api/v4/admin/event/:id   --> github.com/cloudreve/Cloudreve/v4/routers/controllers.Admin`GET`AuditLog (12 handlers)
- 方法: `POST`   /api/v4/admin/event/batch/delete --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminBatchDeleteAuditLog (12 handlers)
- 方法: `POST`   /api/v4/admin/share       --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminListShares (12 handlers)
- 方法: `GET`    /api/v4/admin/share/:id   --> github.com/cloudreve/Cloudreve/v4/routers/controllers.Admin`GET`Share (12 handlers)
- 方法: `POST`   /api/v4/admin/share/batch/delete --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminBatchDeleteShare (12 handlers)
- 方法: `POST`   /api/v4/admin/payment     --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminListPayments (12 handlers)
- 方法: `POST`   /api/v4/admin/payment/batch/delete --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AdminBatchDeletePayment (12 handlers)

## WebDAV 路由

###
- 方法: `GET`    /dav/*path                --> github.com/cloudreve/Cloudreve/v4/pkg/webdav.ServeHTTP (9 handlers)
- 方法: `POST`   /dav/*path                --> github.com/cloudreve/Cloudreve/v4/pkg/webdav.ServeHTTP (9 handlers)
- 方法: `PUT`    /dav/*path                --> github.com/cloudreve/Cloudreve/v4/pkg/webdav.ServeHTTP (9 handlers)
- 方法: `PATCH`  /dav/*path                --> github.com/cloudreve/Cloudreve/v4/pkg/webdav.ServeHTTP (9 handlers)
- 方法: `HEAD`   /dav/*path                --> github.com/cloudreve/Cloudreve/v4/pkg/webdav.ServeHTTP (9 handlers)
- 方法: `OPTIONS` /dav/*path                --> github.com/cloudreve/Cloudreve/v4/pkg/webdav.ServeHTTP (9 handlers)
- 方法: `DELETE` /dav/*path                --> github.com/cloudreve/Cloudreve/v4/pkg/webdav.ServeHTTP (9 handlers)
- 方法: `CONNECT` /dav/*path                --> github.com/cloudreve/Cloudreve/v4/pkg/webdav.ServeHTTP (9 handlers)
- 方法: `TRACE`  /dav/*path                --> github.com/cloudreve/Cloudreve/v4/pkg/webdav.ServeHTTP (9 handlers)
- 方法: `GET`    /dav                      --> github.com/cloudreve/Cloudreve/v4/pkg/webdav.ServeHTTP (9 handlers)
- 方法: `POST`   /dav                      --> github.com/cloudreve/Cloudreve/v4/pkg/webdav.ServeHTTP (9 handlers)
- 方法: `PUT`    /dav                      --> github.com/cloudreve/Cloudreve/v4/pkg/webdav.ServeHTTP (9 handlers)
- 方法: `PATCH`  /dav                      --> github.com/cloudreve/Cloudreve/v4/pkg/webdav.ServeHTTP (9 handlers)
- 方法: `HEAD`   /dav                      --> github.com/cloudreve/Cloudreve/v4/pkg/webdav.ServeHTTP (9 handlers)
- 方法: `OPTIONS` /dav                      --> github.com/cloudreve/Cloudreve/v4/pkg/webdav.ServeHTTP (9 handlers)
- 方法: `DELETE` /dav                      --> github.com/cloudreve/Cloudreve/v4/pkg/webdav.ServeHTTP (9 handlers)
- 方法: `CONNECT` /dav                      --> github.com/cloudreve/Cloudreve/v4/pkg/webdav.ServeHTTP (9 handlers)
- 方法: `TRACE`  /dav                      --> github.com/cloudreve/Cloudreve/v4/pkg/webdav.ServeHTTP (9 handlers)
- 方法: `PROPFIND` /dav/*path                --> github.com/cloudreve/Cloudreve/v4/pkg/webdav.ServeHTTP (9 handlers)
- 方法: `PROPFIND` /dav                      --> github.com/cloudreve/Cloudreve/v4/pkg/webdav.ServeHTTP (9 handlers)
- 方法: `MKCOL`  /dav/*path                --> github.com/cloudreve/Cloudreve/v4/pkg/webdav.ServeHTTP (9 handlers)
- 方法: `LOCK`   /dav/*path                --> github.com/cloudreve/Cloudreve/v4/pkg/webdav.ServeHTTP (9 handlers)
- 方法: `UNLOCK` /dav/*path                --> github.com/cloudreve/Cloudreve/v4/pkg/webdav.ServeHTTP (9 handlers)
- 方法: `PROPPATCH` /dav/*path                --> github.com/cloudreve/Cloudreve/v4/pkg/webdav.ServeHTTP (9 handlers)
- 方法: `COPY`   /dav/*path                --> github.com/cloudreve/Cloudreve/v4/pkg/webdav.ServeHTTP (9 handlers)
- 方法: `MOVE`   /dav/*path                --> github.com/cloudreve/Cloudreve/v4/pkg/webdav.ServeHTTP (9 handlers)

## 分享路由

###
- 方法: `PUT`    /api/v4/share             --> github.com/cloudreve/Cloudreve/v4/routers/controllers.CreateShare (12 handlers)
- 方法: `POST`   /api/v4/share/:id         --> github.com/cloudreve/Cloudreve/v4/routers/controllers.EditShare (13 handlers)

### 获得分享参数
- 方法: `GET`
- 路径: `/api/v4/share/info/:id`
- 响应示例:
```json
{
    "code":0,
    "data":{
        "id":"0721",
        "name":"支付宝无限余额版.apk",
        "visited":0,
        "unlocked":true,
        "source_type":0,
        "owner":{
            "id":"mDi2",
            "nickname":"于小丘",
            "avatar":"file",
            "created_at":"2025-03-23T11:30:49.481874608+08:00"
            },
        "created_at":"2025-03-27T17:34:25.820528407+08:00",
        "expired":false,
        "permissions":"Dw==",
        "url":"https://cloudreve.example.com/s/0721"
        },
    "msg":""
}
```
- 方法: `GET`    /api/v4/share             --> github.com/cloudreve/Cloudreve/v4/routers/controllers.ListShare (11 handlers)
- 方法: `DELETE` /api/v4/share/:id         --> github.com/cloudreve/Cloudreve/v4/routers/controllers.DeleteShare (12 handlers)

## WorkFlow 路由

###
- 方法: `GET`    /api/v4/workflow          --> github.com/cloudreve/Cloudreve/v4/routers/controllers.ListTasks (11 handlers)
- 方法: `GET`    /api/v4/workflow/progress/:id --> github.com/cloudreve/Cloudreve/v4/routers/controllers.`GET`TaskPhaseProgress (11 handlers)
- 方法: `POST`   /api/v4/workflow/archive  --> github.com/cloudreve/Cloudreve/v4/routers/controllers.CreateArchive (11 handlers)
- 方法: `POST`   /api/v4/workflow/extract  --> github.com/cloudreve/Cloudreve/v4/routers/controllers.ExtractArchive (11 handlers)
- 方法: `POST`   /api/v4/workflow/relocate --> github.com/cloudreve/Cloudreve/v4/routers/controllers.Relocate (12 handlers)
- 方法: `POST`   /api/v4/workflow/download --> github.com/cloudreve/Cloudreve/v4/routers/controllers.CreateRemoteDownload (12 handlers)
- 方法: `PATCH`  /api/v4/workflow/download/:id --> github.com/cloudreve/Cloudreve/v4/routers/controllers.SetDownloadTaskTar`GET` (13 handlers)
- 方法: `DELETE` /api/v4/workflow/download/:id --> github.com/cloudreve/Cloudreve/v4/routers/controllers.CancelDownloadTask (12 handlers)

## WOPI 路由

###
- 方法: `GET`    /api/v4/file/wopi/:id     --> github.com/cloudreve/Cloudreve/v4/routers/controllers.CheckFileInfo (8 handlers)
- 方法: `GET`    /api/v4/file/wopi/:id/contents --> github.com/cloudreve/Cloudreve/v4/routers/controllers.`GET`File (8 handlers)
- 方法: `POST`   /api/v4/file/wopi/:id/contents --> github.com/cloudreve/Cloudreve/v4/routers/controllers.PutFile (9 handlers)
- 方法: `POST`   /api/v4/file/wopi/:id     --> github.com/cloudreve/Cloudreve/v4/routers/controllers.ModifyFile (8 handlers)

## 未知路由

###
- 方法: `PUT`    /api/v4/vas/payment       --> github.com/cloudreve/Cloudreve/v4/routers/controllers.CreatPayment (11 handlers)
- 方法: `GET`    /api/v4/vas/payment/status/:id/:trade_no --> github.com/cloudreve/Cloudreve/v4/routers/controllers.CheckPayment (12 handlers)
- 方法: `GET`    /api/v4/vas/giftcode/:code --> github.com/cloudreve/Cloudreve/v4/routers/controllers.`GET`RedeemInfo (13 handlers)
- 方法: `POST`   /api/v4/vas/giftcode/:code/redeem --> github.com/cloudreve/Cloudreve/v4/routers/controllers.DoRedeem (13 handlers)
- 方法: `GET`    /api/v4/group/list        --> github.com/cloudreve/Cloudreve/v4/routers/controllers.`GET`GroupList (10 handlers)
- 方法: `GET`    /api/v4/devices/dav       --> github.com/cloudreve/Cloudreve/v4/routers/controllers.ListDavAccounts (11 handlers)
- 方法: `PUT`    /api/v4/devices/dav       --> github.com/cloudreve/Cloudreve/v4/routers/controllers.CreateDAVAccounts (12 handlers)
- 方法: `PATCH`  /api/v4/devices/dav/:id   --> github.com/cloudreve/Cloudreve/v4/routers/controllers.UpdateDAVAccounts (13 handlers)
- 方法: `DELETE` /api/v4/devices/dav/:id   --> github.com/cloudreve/Cloudreve/v4/routers/controllers.DeleteDAVAccounts (12 handlers)

- 方法: `GET`    /f/:id/:name              --> github.com/cloudreve/Cloudreve/v4/routers/controllers.AnonymousPermLink (7 handlers)
- 方法: `GET`    /s/:id                    --> github.com/cloudreve/Cloudreve/v4/routers/controllers.ShareRedirect (7 handlers)
- 方法: `GET`    /s/:id/:password          --> github.com/cloudreve/Cloudreve/v4/routers/controllers.ShareRedirect (7 handlers)